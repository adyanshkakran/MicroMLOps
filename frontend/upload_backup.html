<!DOCTYPE html>
<html lang="en">
  <head>
    <title>MLOps</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="p-2 flex justify-center flex-col">
    <div class="text-4xl text-center mb-12">MicroMLOps</div>
    <input type="file" id="file" class="text-center mb-6">
    <button class="btn" id="submit">Submit</button>

    <div class="text-center text-xl">
      <p>Result</p>
      <p id="result"></p>
    </div>

    <script>
      const connectWebsocket = (wsId) => {
        // const wsUrl = 'ws://' + window.location.host + '/ws/' + wsId;
        const wsUrl = "ws://localhost:8000/ws/" + wsId;
        try {
          const websocket = new WebSocket(wsUrl);
          websocket.onmessage = (e) => {
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = e.data;
          };
        } catch (error) {
          console.log(error);
        }
      };

      const submit = (e) => {
        e.preventDefault();
        const file = document.getElementById("file").files[0];
        const formData = new FormData();
        formData.append("config_file", file);
        // const uploadUrl = 'http://' + window.location.host + '/upload';
        const uploadUrl = "http://localhost:8000/upload"
        fetch(uploadUrl, {
          method: "POST",
          body: formData,
        })
          .then((res) => res.json())
          .then((res) => {console.log(res); connectWebsocket(res.uuid)})
          .catch((err) => console.log(err));
      };

      document.getElementById("submit").addEventListener("click", (e) => submit(e));
    </script>
  </body>
</html>
